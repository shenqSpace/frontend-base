# 变量、作用域、内存

## 4.3 垃圾回收

JS垃圾回收的基本思路是：确定哪个变量不会再使用，然后释放它占用的内存。这个过程是周期性的，即垃圾回收程序每隔一定时间（或者说在代码执行过程中某个预定的收集时间）就会自动运行。

JavaScript 中的垃圾回收机制主要基于**标记清理**（Mark and Sweep）原理。这个过程的核心目标是找到不再使用的内存，以便将其回收，以供将来的使用。以下是标记清理原理的基本工作流程：

1. **标记阶段（Marking）**：

* 垃圾回收器首先会从根对象（通常是全局对象或者是由全局对象引用的对象）开始遍历对象图。
* 在这个遍历过程中，它会标记所有可以访问到的对象，通常是通过可达性分析（Reachability Analysis）实现的。可达性分析会从根对象出发，递归地访问所有与之直接或间接连接的对象。
* 被标记的对象被视为“存活”的对象，而未被标记的对象则被认为是垃圾。

2. **清理阶段（Sweeping）**：

* 一旦标记阶段完成，垃圾回收器会进行清理操作。
* 它会遍历堆中的所有对象，检查哪些对象没有被标记。这些未被标记的对象被视为不再使用。
* 垃圾回收器会释放这些未被标记的对象所占用的内存。

3. **回收阶段**：

* 在清理阶段完成后，内存中已经被释放的区域将会合并，以便在将来的分配中使用。
* 这个阶段通常由 JavaScript 引擎自动完成，开发者无需手动干预。

需要注意的是，JavaScript 中的垃圾回收是自动进行的，通常由 JavaScript 引擎负责。开发者通常不需要关心垃圾回收的详细过程，但了解这个基本原理可以帮助你编写更有效率、内存友好的代码。另外，对于某些特殊情况，了解垃圾回收机制可能有助于解决内存泄漏等问题。



